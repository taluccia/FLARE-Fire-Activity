---
title: "Bounding Boxes"
author: "Anna Talucci"
date: "2/26/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Overview

What is included in this script:

# Packages

```{r include=FALSE}
library(sp)
library(sf)
library(rgdal) # geospatial data
library(raster)
library(rgeos) # GIS Geometry
library(foreign) # deals with dbf files
library(dplyr)
```

# Projections
```{r}
wgs_proj =  "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs "

```

# Create Bounding Box for FLARE

Define coordinates in a matrix as Longitude, lattitude from Upper Left to Upper right, to lower right, to lower left 

## FLARE coordinates 

```{r}
coords_flare = matrix(c(118.94, 72.26,
               171.0, 72.26,
               171.0, 60.0, 
               118.94, 60.0), 
             ncol = 2, byrow = TRUE)
```

## NE Siberia coordinates 

```{r}
coords_neSiberia = matrix(c(118.0, 74.26,
               190.25, 74.26,
               190.25, 60.0, 
               118.0, 60.0), 
             ncol = 2, byrow = TRUE)
```

## Arctic Circle coordinates 

```{r}
coords_ArcticCircle = matrix(c(118.0, 74.26,
               190.25, 74.26,
               190.25, 66.5, 
               118.0, 66.5), 
             ncol = 2, byrow = TRUE)
```

## Far NE Siberia coordinates 

```{r}
coords_FneSiberia = matrix(c(170.5, 74.26,
               190.25, 74.26,
               190.25, 60.0, 
               170.5, 60.0), 
             ncol = 2, byrow = TRUE)
```

## Yakutsk Bounding Box
Long, Lat
UL 129.9975, 63.7097
UR 137.2975, 63.7097
LR 137.2975, 61.3456
LL 129.9975, 61.3456
```{r}
coords_yak = matrix(c(129.99, 63.70,
               137.29, 63.70,
               137.29, 61.34, 
               129.99, 61.34), 
             ncol = 2, byrow = TRUE)
```

## Convert to Polygon
```{r}
flare_coord = Polygon(coords_flare)
nesiberia_coord = Polygon(coords_neSiberia)

Fne_coord = Polygon(coords_FneSiberia)
yak_coord = Polygon(coords_yak)
```

```{r}
AC_coord = Polygon(coords_ArcticCircle)
```


```{r}
flare_poly = SpatialPolygons(list(Polygons(list(flare_coord), ID = "a")), proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))

ne_poly = SpatialPolygons(list(Polygons(list(nesiberia_coord), ID = "a")), proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))

Fne_poly = SpatialPolygons(list(Polygons(list(Fne_coord), ID = "a")), proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))

yak_poly = SpatialPolygons(list(Polygons(list(yak_coord), ID = "a")), proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))
```

```{r}
AC_poly = SpatialPolygons(list(Polygons(list(AC_coord), ID = "a")), proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))

```


## Plot
```{r}
plot(flare_poly, axes = TRUE)
```

```{r}
plot(Fne_poly, axes = TRUE)
```

```{r}
plot(yak_poly, axes = TRUE)
```

## Convertfrom sp to sf

```{r}
flare_sf = st_as_sf(flare_poly) 
ne_sf = st_as_sf(ne_poly)
Fne_sf = st_as_sf(Fne_poly)
yak_sf = st_as_sf(yak_poly) 
```

```{r}
AC_sf = st_as_sf(AC_poly)
```


## Write bounding box to shapefile

```{r eval=FALSE, include=FALSE}
st_write(flare_sf, "../outputs/bbox/FLARE_bbox.shp", driver="ESRI Shapefile")  # create to a shapefile 

st_write(ne_sf, "../outputs/bbox/neSiberia_bbox.shp", driver="ESRI Shapefile")

st_write(Fne_sf, "../outputs/bbox/FarNE_bbox.shp", driver="ESRI Shapefile")

st_write(yak_sf, "../outputs/bbox/yakutsk_bbox.shp", driver="ESRI Shapefile")
```

```{r}

st_write(AC_sf, "../outputs/bbox/ArcticCircle_bbox.shp", driver="ESRI Shapefile")
```


# Create Bounding Boxes for Ecozone Extent

## Equal Area Ecozones
```{r}
eco_ee = readOGR("../data/ecozones/ne_siberia_ecozones_ee.shp", "ne_siberia_ecozones_ee") 
```

**Ecozone Extent from ecozone layer**
bbox:           xmin: -180 ymin: 50.13147 xmax: 180 ymax: 77.76253
bbox:           xmin: 130.1842 ymin: 68.56218 xmax: 161.9283 ymax: 72.9427
bbox:           xmin: 79.01171 ymin: 64.7211 xmax: 130.4216 ymax: 77.79169
bbox:           xmin: 86.27558 ymin: 50.10451 xmax: 142.6297 ymax: 71.44453
bbox:           xmin: 124.9269 ymin: 58.78296 xmax: 170.2515 ymax: 71.75275
bbox:           xmin: -179.9998 ymin: 59.77511 xmax: 179.9998 ymax: 70.15549
bbox:           xmin: -179.9995 ymin: 64.20744 xmax: 179.9971 ymax: 69.00497

**Create 3 ecozones to span the ecozones we are interested and deal with the Chukchi Peninsula**
1. Ecozones west xmin: 78 ymin: 50.0 xmax: 129 ymax: 78.0
2. Ecozones east xmin:  128.5 ymin: 50.0 xmax: 180 ymax: 78.0
3. Ecozones Chukchi xmin: -180 ymin: 50.0 xmax: -168 ymax: 78.0

How to formate the matrix for the bounding box
matrix(c(xmin, ymax,
               xmax, ymax,
               xmax, ymin, 
               xmin, ymin), 
             ncol = 2, byrow = TRUE)
```{r}
eco_west = matrix(c(78.0, 78.0,
               129.0, 78.0,
               129.0, 50.0, 
               78.0, 50.0), 
             ncol = 2, byrow = TRUE)


eco_west_coords = Polygon(eco_west)
eco_west_bbox = SpatialPolygons(list(Polygons(list(eco_west_coords), ID = "a")), proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))
```

```{r}
plot(eco_west_bbox)
```

```{r}
eco_east = matrix(c(128.5, 78.0,
               180.0, 78.0,
               180.0, 50.0, 
               128.5, 50.0), 
             ncol = 2, byrow = TRUE)


eco_east_coords = Polygon(eco_east)
eco_east_bbox = SpatialPolygons(list(Polygons(list(eco_east_coords), ID = "a")), proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))
```

```{r}
plot(eco_east_bbox)
```

```{r}
eco_chukchi = matrix(c(-168.0, 78.0,
               -180.0, 78.0,
               -180.0, 50.0, 
               -168.0, 50.0), 
             ncol = 2, byrow = TRUE)


eco_chukchi_coords = Polygon(eco_chukchi)
eco_chukchi_bbox = SpatialPolygons(list(Polygons(list(eco_chukchi_coords), ID = "a")), proj4string=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))
```

```{r}
plot(eco_chukchi_bbox)
```

```{r}
eco_west_bbox_ee = spTransform(eco_west_bbox, CRS(ee_russia))
eco_east_bbox_ee = spTransform(eco_east_bbox, CRS(ee_russia))
eco_chukchi_bbox_ee = spTransform(eco_chukchi_bbox, CRS(ee_russia))
```



### Plot data
```{r}
plot(eco_ee)
plot(eco_west_bbox_ee, add=TRUE)
```


```{r eval=FALSE, include=FALSE}
st_write(eco_west_bbox, "../outputs/bbox/eco_west.shp", driver="ESRI Shapefile")  # create to a shapefile 

st_write(eco_east_bbox, "../outputs/bbox/eco_east.shp", driver="ESRI Shapefile")

st_write(eco_chukchi_bbox, "../outputs/bbox/eco_chukchi.shp", driver="ESRI Shapefile")

```
