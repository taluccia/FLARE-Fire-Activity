---
title: "Test-hotspot-cutOFF-Issue"
author: "Anna Talucci"
date: "3/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Overview
This code uses the [WWF Ecozones shapefile](https://www.worldwildlife.org/publications/terrestrial-ecoregions-of-the-world). We subset the ecozones for NE Siberia to include the following:

1. Bering tundra
2. Chukchi peninsula tundra
3. Cherskii-Kolyma mountain tundra
4. East Siberia Tiaga
5. Northeast Siberia coastal Tundra
6. Northeast Siberia taiga
7. Taimyr-central Siberia tundra 
8. Trans-Baikal Bald Mountain Tundra

While we will need the attribute field for the final fire perimeters, they are not neccessary for the polygons we use in GEE.



# Library

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(purrr)
library(readr)
library(cowplot)
library(ggcorrplot)
library(sp)
library(sf)
library(rgdal) # geospatial data
library(raster)
library(rgeos) # GIS Geometry
library(foreign) # deals with dbf files
library(spatialEco)
```

# Projections

WGS 84 need for gee
```{r}
wgs_proj =  "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs "

```

Equal Area projection for russia need for buffering hotspot data
https://gis.stackexchange.com/questions/264093/projection-for-russia-map

+proj=aea +lat_1=50 +lat_2=70 +lat_0=56 +lon_0=100 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs 

```{r}
ee_russia = "+proj=aea +lat_1=50 +lat_2=70 +lat_0=56 +lon_0=100 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs "
```

# Data
st_write(ne_subset_ee, "../outputs/ecozones/ne_siberia_ecozones9_ee.shp", driver="ESRI Shapefile") 

```{r}
ecozone = st_read("../data/ecozones/ne_siberia_ecozones9_ee.shp", "ne_siberia_ecozones9_ee") 
```

```{r}
ru = st_read("../data/russia/RUS_adm0.shp", "RUS_adm0") 
```

```{r}
head(ecozone)
```
# Equal Area
```{r}
ru_ee = st_transform(ru, crs=ee_russia)
```


# Plot
```{r}
plot(ru_ee$geometry, col = '#ff333388'); #x
plot(ecozone$geometry, add=TRUE, col='#33ff3388')#y
title("russia: red,ecozone: green")
```


# Apply buffer to ecozone
```{r}
eco_buf_110km = st_buffer(ecozone, 110000)

eco_buf_110km_un = sf::st_union(eco_buf_110km)

eco_buf_110km_un_poly <- sf::st_cast(eco_buf_110km_un, "POLYGON")
```


```{r}
plot(eco_buf_110km_un_poly)
```



```{r}
plot(ru_ee$geometry, col = '#ff333388'); #x
plot(eco_buf_110km_un_poly, add=TRUE, col='#33ff3388')#y
title("russia: red,ecozone: green")
```

```{r eval=FALSE, include=FALSE}
st_write(eco_buf_110km_un_poly, "../outputs/ecozones/eco_SinglePoly_ee.shp", driver="ESRI Shapefile") 
```


# Split into 2 groups for large data

## Group 1 North East
```{r}
group1 = ecozone %>% 
  filter(eco_code %in% c("CKMT", "NST", "NSCT", "CPT", "BT"))
```

```{r}
ggplot(group1) + geom_sf()
```

# Apply buffer to ecozone
```{r}
grp1_buf_1km = st_buffer(group1, 1000)

grp1_buf_1km_un = sf::st_union(grp1_buf_1km)

grp1_buf_1km_un_poly <- sf::st_cast(grp1_buf_1km_un, "POLYGON")
```

```{r}
plot(ru_ee$geometry, col = '#ff333388'); #x
plot(grp1_buf_1km_un_poly, add=TRUE, col='#33ff3388')#y
title("russia: red,ecozone: green")
```

```{r eval=FALSE, include=FALSE}
st_write(grp1_buf_1km_un_poly, "../outputs/ecozones/eco_NEPoly1_ee.shp", driver="ESRI Shapefile") 
```

## Group 2  Eastern Siberia
```{r}
group2 = ecozone %>% 
  filter(eco_code %in% c("EST", "TBBMT", "TCST", "SSFS"))
```

```{r}
ggplot(group2) + geom_sf()
```

# Apply buffer to ecozone
```{r}
grp2_buf_110km = st_buffer(group2, 110000)

grp2_buf_110km_un = sf::st_union(grp2_buf_110km)

grp2_buf_110km_un_poly <- sf::st_cast(grp2_buf_110km_un, "POLYGON")

grp2_buf_1km = st_buffer(grp2_buf_110km_un_poly, -109000)
```

```{r}
plot(ru_ee$geometry, col = '#ff333388'); #x
plot(grp2_buf_1km , add=TRUE, col='#33ff3388')#y
plot(group2, add=TRUE)
title("russia: red,ecozone: green")
```

```{r eval=FALSE, include=FALSE}
st_write(grp2_buf_1km, "../outputs/ecozones/eco_EPoly2_ee.shp", driver="ESRI Shapefile") 
```