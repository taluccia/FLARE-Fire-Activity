---
title: "Clean Polygon data"
author: "Anna Talucci"
date: "3/09/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview

Using GEE Part 2 Vectors Ecozone, we remove holes, convert from multipoly to polygon, apply negative buffer, and combine into single shapefile

What is included in this script:

# Packages

```{r include=FALSE}
library(sp)
library(sf)
library(rgdal) # geospatial data
library(raster)
library(rgeos) # GIS Geometry
library(foreign) # deals with dbf files
library(dplyr)
library(tidyr)
library(spatialEco)
library(ggplot2)
```

# Projections

WGS 84 need for gee
```{r}
wgs_proj =  "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs "
```

Equal Area projection for russia need for buffering hotspot data
https://gis.stackexchange.com/questions/264093/projection-for-russia-map

+proj=aea +lat_1=50 +lat_2=70 +lat_0=56 +lon_0=100 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs 

```{r}
ee_russia = "+proj=aea +lat_1=50 +lat_2=70 +lat_0=56 +lon_0=100 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs "
```


# Read in shapefile
ckmt_nst_nsct_flare_fires2001
cpt_bt_east_flare_fires_2001
cpt_bt_west_flare_fires_2001
est_tbbmt_n_flare_fires_2001
est_tbbmt_s_flare_fires_2001
tcst_n_flare_fires_2001
tcst_s_flare_fires_2001
```{r}
ckmt_nst_nsct = readOGR("../data/part2_vector_ecozone/2001/ckmt_nst_nsct_flare_fires2001.shp", "ckmt_nst_nsct_flare_fires2001") 
cpt_bt_east = readOGR("../data/part2_vector_ecozone/2001/cpt_bt_east_flare_fires_2001.shp", "cpt_bt_east_flare_fires_2001") 
cpt_bt_west = readOGR("../data/part2_vector_ecozone/2001/cpt_bt_west_flare_fires_2001.shp", "cpt_bt_west_flare_fires_2001") 
est_tbbmt_n = readOGR("../data/part2_vector_ecozone/2001/est_tbbmt_n_flare_fires_2001.shp", "est_tbbmt_n_flare_fires_2001") 
est_tbbmt_s = readOGR("../data/part2_vector_ecozone/2001/est_tbbmt_s_flare_fires_2001.shp", "est_tbbmt_s_flare_fires_2001") 
tcst_n = readOGR("../data/part2_vector_ecozone/2001/tcst_n_flare_fires_2001.shp", "tcst_n_flare_fires_2001") 
tcst_s = readOGR("../data/part2_vector_ecozone/2001/tcst_s_flare_fires_2001.shp", "tcst_s_flare_fires_2001") 
```


# Reproject in Equal area

```{r}
ckmt_nst_nsct_ee = spTransform(ckmt_nst_nsct, CRS(ee_russia))
cpt_bt_east_ee = spTransform(cpt_bt_east, CRS(ee_russia))
cpt_bt_west_ee = spTransform(cpt_bt_west, CRS(ee_russia))
est_tbbmt_n_ee = spTransform(est_tbbmt_n, CRS(ee_russia))
est_tbbmt_s_ee = spTransform(est_tbbmt_s, CRS(ee_russia))
tcst_n_ee = spTransform(tcst_n, CRS(ee_russia))
tcst_s_ee = spTransform(tcst_s , CRS(ee_russia))
```


# Remove holes inside polygons
```{r}
ckmt_nst_nsct_nh = remove.holes(ckmt_nst_nsct_ee)
cpt_bt_east_nh = remove.holes(cpt_bt_east_ee)
cpt_bt_west_nh = remove.holes(cpt_bt_west_ee)
est_tbbmt_n_nh = remove.holes(est_tbbmt_n_ee)
est_tbbmt_s_nh = remove.holes(est_tbbmt_s_ee)
tcst_n_nh = remove.holes(tcst_n_ee)
tcst_s_nh = remove.holes(tcst_s_ee)
```
# apply Negative buffer

```{r}
ckmt_nst_nsct_buf = gBuffer(ckmt_nst_nsct_nh, width = -500, capStyle="ROUND", joinStyle="ROUND")
cpt_bt_east_buf = gBuffer(cpt_bt_east_nh, width = -500, capStyle="ROUND", joinStyle="ROUND")
cpt_bt_west_buf = gBuffer(cpt_bt_west_nh, width = -500, capStyle="ROUND", joinStyle="ROUND")
est_tbbmt_n_buf = gBuffer(est_tbbmt_n_nh, width = -500, capStyle="ROUND", joinStyle="ROUND")
est_tbbmt_s_buf = gBuffer(est_tbbmt_s_nh, width = -500, capStyle="ROUND", joinStyle="ROUND")
tcst_n_buf = gBuffer(tcst_n_nh, width = -500, capStyle="ROUND", joinStyle="ROUND")
tcst_s_buf = gBuffer(tcst_s_nh, width = -500, capStyle="ROUND", joinStyle="ROUND")

```

# Convert from sp to sf and from Multipolygon to Polygon
```{r}
ckmt_nst_nsct_sf = ckmt_nst_nsct_buf %>% st_as_sf() %>% st_cast("POLYGON") 
cpt_bt_east_sf = cpt_bt_east_buf %>% st_as_sf() %>% st_cast("POLYGON") 
cpt_bt_west_sf = cpt_bt_west_buf %>% st_as_sf() %>% st_cast("POLYGON") 
est_tbbmt_n_sf = est_tbbmt_n_buf %>% st_as_sf() %>% st_cast("POLYGON") 
est_tbbmt_s_sf = est_tbbmt_s_buf %>% st_as_sf() %>% st_cast("POLYGON") 
tcst_n_sf = tcst_n_buf %>% st_as_sf() %>% st_cast("POLYGON") 
tcst_s_sf = tcst_s_buf %>% st_as_sf() %>% st_cast("POLYGON") 

```


# Combine into one shapefile
```{r}
all_shp = rbind(ckmt_nst_nsct_sf, cpt_bt_east_sf, cpt_bt_west_sf, est_tbbmt_n_sf, est_tbbmt_s_sf, tcst_n_sf, tcst_s_sf)
```


# Write to shapefile

```{r eval=FALSE, include=FALSE}
st_write(all_shp, "../outputs/clean-shapefile-ecozone/combine_ecozones_2001.shp", driver="ESRI Shapefile") 

```











